{
    "title": "PHP Swoole CRUD Microservice",
    "uid": "php-swoole-crud-microservice",
    "timezone": "browser",
    "refresh": "5s",
    "schemaVersion": 36,
    "version": 1,
    "panels": [
        {
            "type": "timeseries",
            "title": "Requests/sec",
            "gridPos": {
                "x": 0,
                "y": 0,
                "w": 12,
                "h": 6
            },
            "targets": [
                {
                    "expr": "rate(http_requests_total_Requests{path=\"$path\", method=\"$method\", status=\"$status\"}[$interval])",
                    "legendFormat": "{{method}} {{path}} {{status}}"
                }
            ]
        },
        {
            "type": "timeseries",
            "title": "Requests/sec per Path",
            "gridPos": {
                "x": 12,
                "y": 0,
                "w": 12,
                "h": 6
            },
            "targets": [
                {
                    "expr": "sum by(path)(rate(http_requests_total_Requests[$interval]))",
                    "legendFormat": "{{path}}"
                }
            ]
        },
        {
            "type": "timeseries",
            "title": "Requests/sec per Method",
            "gridPos": {
                "x": 0,
                "y": 6,
                "w": 12,
                "h": 6
            },
            "targets": [
                {
                    "expr": "sum by(method)(rate(http_requests_total_Requests[$interval]))",
                    "legendFormat": "{{method}}"
                }
            ]
        },
        {
            "type": "timeseries",
            "title": "HTTP Status Codes",
            "gridPos": {
                "x": 12,
                "y": 6,
                "w": 12,
                "h": 6
            },
            "targets": [
                {
                    "expr": "sum by(status)(rate(http_requests_total_Requests[$interval]))",
                    "legendFormat": "{{status}}"
                }
            ]
        },
        {
            "type": "timeseries",
            "title": "Avg HTTP Latency",
            "gridPos": {
                "x": 0,
                "y": 12,
                "w": 12,
                "h": 6
            },
            "targets": [
                {
                    "expr": "rate(http_request_seconds_Latency_sum[$interval]) / rate(http_request_seconds_Latency_count[$interval])",
                    "legendFormat": "avg latency"
                }
            ]
        },
        {
            "type": "timeseries",
            "title": "Latency per Path",
            "gridPos": {
                "x": 12,
                "y": 12,
                "w": 12,
                "h": 6
            },
            "targets": [
                {
                    "expr": "sum by(path)(rate(http_request_seconds_Latency_sum[$interval])) / sum by(path)(rate(http_request_seconds_Latency_count[$interval]))",
                    "legendFormat": "{{path}}"
                }
            ]
        },
        {
            "type": "timeseries",
            "title": "Latency per Method",
            "gridPos": {
                "x": 0,
                "y": 18,
                "w": 12,
                "h": 6
            },
            "targets": [
                {
                    "expr": "sum by(method)(rate(http_request_seconds_Latency_sum[$interval])) / sum by(method)(rate(http_request_seconds_Latency_count[$interval]))",
                    "legendFormat": "{{method}}"
                }
            ]
        },
        {
            "type": "heatmap",
            "title": "HTTP Request Latency Heatmap",
            "gridPos": {
                "x": 12,
                "y": 18,
                "w": 12,
                "h": 6
            },
            "targets": [
                {
                    "expr": "sum by(le)(rate(http_request_seconds_Latency_bucket[$interval]))",
                    "format": "heatmap",
                    "legendFormat": "â‰¤{{le}}s"
                }
            ],
            "color": {
                "mode": "spectrum"
            }
        },
        {
            "type": "timeseries",
            "title": "Latency P95",
            "gridPos": {
                "x": 0,
                "y": 24,
                "w": 12,
                "h": 6
            },
            "targets": [
                {
                    "expr": "histogram_quantile(0.95, sum by(le)(rate(http_request_seconds_Latency_bucket[$interval])))",
                    "legendFormat": "P95"
                }
            ]
        },
        {
            "type": "timeseries",
            "title": "Latency P99",
            "gridPos": {
                "x": 12,
                "y": 24,
                "w": 12,
                "h": 6
            },
            "targets": [
                {
                    "expr": "histogram_quantile(0.99, sum by(le)(rate(http_request_seconds_Latency_bucket[$interval])))",
                    "legendFormat": "P99"
                }
            ]
        },
        {
            "type": "stat",
            "title": "PHP Version",
            "gridPos": {
                "x": 0,
                "y": 30,
                "w": 6,
                "h": 4
            },
            "targets": [
                {
                    "expr": "php_info",
                    "legendFormat": "{{version}}"
                }
            ]
        },
        {
            "type": "stat",
            "title": "PHP Memory Usage",
            "gridPos": {
                "x": 6,
                "y": 30,
                "w": 6,
                "h": 4
            },
            "targets": [
                {
                    "expr": "php_memory_usage_bytes",
                    "legendFormat": "memory"
                }
            ]
        },
        {
            "type": "timeseries",
            "title": "PHP CPU Usage",
            "gridPos": {
                "x": 12,
                "y": 30,
                "w": 12,
                "h": 4
            },
            "targets": [
                {
                    "expr": "rate(php_cpu_seconds_total[$interval])",
                    "legendFormat": "cpu"
                }
            ]
        },
        {
            "type": "stat",
            "title": "Swoole Active Connections",
            "gridPos": {
                "x": 0,
                "y": 34,
                "w": 6,
                "h": 4
            },
            "targets": [
                {
                    "expr": "swoole_connections_active",
                    "legendFormat": "active"
                }
            ]
        },
        {
            "type": "timeseries",
            "title": "Swoole Total Connections",
            "gridPos": {
                "x": 6,
                "y": 34,
                "w": 6,
                "h": 4
            },
            "targets": [
                {
                    "expr": "increase(swoole_connections_total[$interval])",
                    "legendFormat": "total"
                }
            ]
        },
        {
            "type": "stat",
            "title": "Swoole Task Waiting",
            "gridPos": {
                "x": 12,
                "y": 34,
                "w": 6,
                "h": 4
            },
            "targets": [
                {
                    "expr": "swoole_task_waiting",
                    "legendFormat": "waiting"
                }
            ]
        },
        {
            "type": "timeseries",
            "title": "Requests Errors (5xx)",
            "gridPos": {
                "x": 18,
                "y": 34,
                "w": 6,
                "h": 4
            },
            "targets": [
                {
                    "expr": "sum by(path)(rate(http_requests_total_Requests{status=~\"5..\"}[$interval]))",
                    "legendFormat": "{{path}}"
                }
            ]
        },
        {
            "type": "timeseries",
            "title": "Requests 4xx",
            "gridPos": {
                "x": 0,
                "y": 38,
                "w": 12,
                "h": 4
            },
            "targets": [
                {
                    "expr": "sum by(path)(rate(http_requests_total_Requests{status=~\"4..\"}[$interval]))",
                    "legendFormat": "{{path}}"
                }
            ]
        },
        {
            "type": "bargauge",
            "title": "Requests > 500ms",
            "gridPos": {
                "x": 12,
                "y": 38,
                "w": 12,
                "h": 4
            },
            "targets": [
                {
                    "expr": "(sum by(path)(rate(http_request_seconds_Latency_count[$interval])) - sum by(path)(rate(http_request_seconds_Latency_bucket{le=\"0.5\"}[$interval])))",
                    "legendFormat": "{{path}}"
                }
            ]
        },
        {
            "type": "bargauge",
            "title": "Request Count per Endpoint",
            "gridPos": {
                "x": 0,
                "y": 42,
                "w": 24,
                "h": 6
            },
            "targets": [
                {
                    "expr": "sum by(path)(rate(http_requests_total_Requests[$interval]))",
                    "legendFormat": "{{path}}"
                }
            ]
        }
    ],
    "templating": {
        "list": [
            {
                "current": {
                    "text": "1m",
                    "value": "1m"
                },
                "hide": 0,
                "name": "interval",
                "options": [
                    {
                        "text": "1m",
                        "value": "1m"
                    },
                    {
                        "text": "5m",
                        "value": "5m"
                    },
                    {
                        "text": "1h",
                        "value": "1h"
                    },
                    {
                        "text": "6h",
                        "value": "6h"
                    },
                    {
                        "text": "1d",
                        "value": "1d"
                    }
                ],
                "query": "1m,5m,1h,6h,1d",
                "refresh": 2,
                "type": "interval"
            },
            {
                "current": {
                    "text": "All",
                    "value": [
                        "$__all"
                    ]
                },
                "allValue": ".*",
                "datasource": {
                    "type": "prometheus"
                },
                "hide": 0,
                "includeAll": true,
                "label": "Path",
                "name": "path",
                "options": [],
                "query": "label_values(http_requests_total_Requests, path)",
                "refresh": 1,
                "regex": "",
                "skipUrlSync": false,
                "sort": 0,
                "type": "query"
            },
            {
                "current": {
                    "text": "All",
                    "value": [
                        "$__all"
                    ]
                },
                "allValue": ".*",
                "datasource": {
                    "type": "prometheus"
                },
                "hide": 0,
                "includeAll": true,
                "label": "Method",
                "name": "method",
                "options": [],
                "query": "label_values(http_requests_total_Requests, method)",
                "refresh": 1,
                "regex": "",
                "skipUrlSync": false,
                "sort": 0,
                "type": "query"
            },
            {
                "current": {
                    "text": "All",
                    "value": [
                        "$__all"
                    ]
                },
                "allValue": ".*",
                "datasource": {
                    "type": "prometheus"
                },
                "hide": 0,
                "includeAll": true,
                "label": "Status",
                "name": "status",
                "options": [],
                "query": "label_values(http_requests_total_Requests, status)",
                "refresh": 1,
                "regex": "",
                "skipUrlSync": false,
                "sort": 0,
                "type": "query"
            }
        ]
    },
    "time": {
        "from": "now-1h",
        "to": "now"
    },
    "timepicker": {
        "refresh_intervals": [
            "5s",
            "10s",
            "30s",
            "1m",
            "5m",
            "15m",
            "30m",
            "1h",
            "2h",
            "1d"
        ],
        "time_options": [
            "5m",
            "15m",
            "1h",
            "6h",
            "12h",
            "24h",
            "2d",
            "7d",
            "30d"
        ]
    }
}