<?xml version="1.0" encoding="UTF-8"?>
<ruleset name="Production PHPMD Ruleset"
    xmlns="http://phpmd.org/ruleset/1.0.0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <description>
        Strict PHPMD rules for PHP 8.x microservices.
        - Complexity, unused code, design &amp; cleancode rules
        - Exclude cosmetic or non-critical rules
    </description>

    <file>src</file>
    <file>tests</file>

    <exclude>vendor</exclude>

    <!-- Core rulesets -->
    <rule ref="rulesets/codesize.xml" />
    <rule ref="rulesets/cleancode.xml" />
    <rule ref="rulesets/design.xml" />
    <rule ref="rulesets/unusedcode.xml" />

    <!-- Relax naming rules -->
    <rule ref="rulesets/naming.xml">
        <exclude name="ShortVariable"/>
        <exclude name="ShortMethodName"/>
    </rule>

    <!-- Stricter thresholds -->
    <rule ref="rulesets/codesize.xml/CyclomaticComplexity">
        <properties>
            <property name="reportLevel" value="8" />
        </properties>
    </rule>
    <rule ref="rulesets/codesize.xml/NPathComplexity">
        <properties>
            <property name="reportLevel" value="100" />
        </properties>
    </rule>
    <rule ref="rulesets/codesize.xml/ExcessiveMethodLength">
        <properties>
            <property name="minimum" value="50" />
        </properties>
    </rule>
    <rule ref="rulesets/codesize.xml/ExcessiveParameterList">
        <properties>
            <property name="minimum" value="5" />
        </properties>
    </rule>
    <rule ref="rulesets/codesize.xml/ExcessiveClassComplexity">
        <properties>
            <property name="reportLevel" value="10" />
        </properties>
    </rule>

    <rule ref="rulesets/cleancode.xml/StaticAccess">
        <properties>
            <property name="exceptions" value="\Swoole\Coroutine" />
        </properties>
    </rule>

    <!-- Exclusions -->
    <exclude-pattern>.git/*</exclude-pattern>
    <exclude-pattern>vendor/*</exclude-pattern>
    <exclude-pattern>build/*</exclude-pattern>
    <exclude-pattern>.github/*</exclude-pattern>
    <exclude-pattern>tests/*</exclude-pattern>

    <!-- Helpers.php specific suppression for StaticAccess -->
    <exclude-pattern>src/Support/helpers.php</exclude-pattern>

    <arg name="extensions" value="php"/>
    <arg name="error-severity" value="1"/>
    <arg name="warning-severity" value="0"/>
</ruleset>
